version: 2

models:
  - name: rpt_activity_list__activity
    description: |
      Reporting model for activity lists.
      Grain: One row per activity.
    columns:
      - name: activity_id
        description: Activity ID (primary key)
        tests:
          - unique
          - not_null
      - name: sport_type
        description: Sport type classification
      - name: activity_date
        description: Local activity date
      - name: distance_miles
        description: Distance in miles
      - name: moving_time_seconds
        description: Moving time in seconds
      - name: elevation_gain_feet
        description: Elevation gain in feet
      - name: activity_link
        description: Evidence route link for the activity

  - name: rpt_activity_detail__activity
    description: |
      Reporting model for activity detail pages.
      Grain: One row per activity.
    columns:
      - name: activity_id
        description: Activity ID (primary key)
        tests:
          - unique
          - not_null
      - name: distance_miles
        description: Distance in miles
      - name: elevation_gain_feet
        description: Elevation gain in feet
      - name: average_speed_mph
        description: Average speed in miles per hour
      - name: max_speed_mph
        description: Max speed in miles per hour
      - name: average_heartrate_bpm
        description: Average heart rate in bpm
      - name: average_watts
        description: Average power in watts

  - name: rpt_activity_hr_zones__activity_zone
    description: |
      Reporting model for heart rate zone distributions.
      Grain: One row per activity per zone.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - activity_id
            - zone_id
    columns:
      - name: activity_id
        description: Activity ID
        tests:
          - not_null
      - name: zone_id
        description: Zone index (1-based)
        tests:
          - not_null
      - name: pct_in_zone
        description: Percent of time spent in zone

  - name: rpt_activity_power_zones__activity_zone
    description: |
      Reporting model for power zone distributions.
      Grain: One row per activity per zone.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - activity_id
            - zone_id
    columns:
      - name: activity_id
        description: Activity ID
        tests:
          - not_null
      - name: zone_id
        description: Zone index (1-based)
        tests:
          - not_null
      - name: pct_in_zone
        description: Percent of time spent in zone

  - name: rpt_activity_monthly__sport_type
    description: |
      Reporting model for monthly sport-level trends.
      Grain: One row per sport_type per month.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sport_type
            - activity_year
            - month_number
    columns:
      - name: sport_type
        description: Sport type classification
        tests:
          - not_null
      - name: activity_year
        description: Activity year
        tests:
          - not_null
      - name: month_number
        description: Month number (1-12)
        tests:
          - not_null
      - name: activity_count
        description: Count of activities in the month
      - name: total_distance_km
        description: Total distance in kilometers

  - name: rpt_activities_by_sport__sport_type
    description: |
      Reporting model for activity summary by sport type.
      Grain: One row per sport_type.
    columns:
      - name: sport_type
        description: Sport type classification
        tests:
          - unique
          - not_null
      - name: sport_slug
        description: Lowercase slug for routing
      - name: activity_count
        description: Count of activities for the sport
      - name: total_distance_km
        description: Total distance in kilometers

  - name: rpt_sport_mix__sport_type
    description: |
      Reporting model for sport mix tiles.
      Grain: One row per sport_type.
    columns:
      - name: sport_type
        description: Sport type classification
        tests:
          - unique
          - not_null
      - name: activity_count
        description: Count of activities for the sport
      - name: total_distance_miles
        description: Total distance in miles

  - name: rpt_home_kpis__all
    description: |
      Reporting model for home dashboard KPIs.
      Grain: Single row (all activities).
    columns:
      - name: total_activity_count
        description: Total number of activities
        tests:
          - not_null
      - name: total_distance_miles
        description: Total distance in miles
      - name: total_moving_time_hours
        description: Total moving time in hours
      - name: total_elevation_gain_feet
        description: Total elevation gain in feet
      - name: avg_speed_mph
        description: Average speed across all activities

  - name: rpt_home_daily_trends__day
    description: |
      Reporting model for daily activity trends.
      Grain: One row per activity_date.
    columns:
      - name: activity_date
        description: Local activity date
        tests:
          - unique
          - not_null
      - name: activity_year
        description: Activity year
      - name: activity_count
        description: Count of activities on the date

  - name: rpt_distinct_years__year
    description: |
      Reporting model for distinct activity years.
      Grain: One row per activity_year.
    columns:
      - name: activity_year
        description: Activity year
        tests:
          - unique
          - not_null
      - name: max_year
        description: Max activity year across the dataset

  - name: rpt_year_kpis__year
    description: |
      Reporting model for year-level KPIs.
      Grain: One row per activity_year.
    columns:
      - name: activity_year
        description: Activity year
        tests:
          - unique
          - not_null
      - name: activity_count
        description: Count of activities in the year

  - name: rpt_year_monthly__month
    description: |
      Reporting model for monthly year rollups.
      Grain: One row per activity_year per month.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - activity_year
            - month_number
    columns:
      - name: activity_year
        description: Activity year
        tests:
          - not_null
      - name: month_number
        description: Month number (1-12)
        tests:
          - not_null
      - name: activity_count
        description: Count of activities in the month

  - name: rpt_year_routes__year
    description: |
      Reporting model for yearly route polylines.
      Grain: One row per activity_year.
    columns:
      - name: activity_year
        description: Activity year
        tests:
          - unique
          - not_null
      - name: polylines
        description: List of activity summary polylines

  - name: rpt_daily_activity_counts__day
    description: |
      Reporting model for daily activity counts.
      Grain: One row per activity_date.
    columns:
      - name: activity_date
        description: Local activity date
        tests:
          - unique
          - not_null
      - name: activity_count
        description: Count of activities on the date

  - name: rpt_activity_summary__activity
    description: |
      Reporting model for lightweight activity summaries.
      Grain: One row per activity.
    columns:
      - name: activity_id
        description: Activity ID (primary key)
        tests:
          - unique
          - not_null
      - name: distance_miles
        description: Distance in miles
      - name: moving_time_hours
        description: Moving time in hours
      - name: elevation_gain_feet
        description: Elevation gain in feet
