models:
  - name: fct_activities
    description: "One row per Strava activity with core metrics and dimensions"
    tests:
      - dbt_utils.expression_is_true:
          expression: "moving_seconds <= elapsed_seconds"
          config:
            severity: warn
      - dbt_utils.expression_is_true:
          expression: "distance >= 0"
      - dbt_utils.expression_is_true:
          expression: "started_at <= current_timestamp"
    columns:
      - name: activity_id
        description: "Unique identifier for the activity"
        tests:
          - unique
          - not_null
      - name: activity_name
        description: "Name of the activity"
        tests:
          - not_null
      - name: activity_type
        description: "Type of activity (Run, Ride, Swim, etc.)"
        tests:
          - not_null
          - accepted_values:
              values: ['Run', 'Ride', 'Swim', 'Walk', 'Hike', 'AlpineSki', 'BackcountrySki', 'Canoeing', 'Crossfit', 'EBikeRide', 'Elliptical', 'Golf', 'Handcycle', 'IceSkate', 'InlineSkate', 'Kayaking', 'Kitesurf', 'NordicSki', 'RockClimbing', 'RollerSki', 'Rowing', 'Snowboard', 'Snowshoe', 'Soccer', 'StairStepper', 'StandUpPaddling', 'Surfing', 'VirtualRide', 'VirtualRun', 'WeightTraining', 'Wheelchair', 'Windsurf', 'Workout', 'Yoga']
              config:
                severity: warn
      - name: started_at
        description: "Start timestamp of activity (UTC)"
        tests:
          - not_null
      - name: started_at_local
        description: "Start timestamp of activity (local timezone)"
        tests:
          - not_null
      - name: distance
        description: "Distance in miles"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: distance_metric
        description: "Distance in kilometers"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: moving_seconds
        description: "Moving time in seconds"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: elapsed_seconds
        description: "Elapsed time in seconds"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: speed_avg
        description: "Average speed in mph"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "speed_avg is not null"
      - name: elevation_gain
        description: "Total elevation gain in feet"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "elevation_gain is not null"
      - name: hr_avg
        description: "Average heart rate (may be null)"
        tests:
          - dbt_utils.expression_is_true:
              expression: "between 30 and 250"
              config:
                where: "hr_avg is not null"
                severity: warn
      - name: hr_max
        description: "Maximum heart rate (may be null)"
        tests:
          - dbt_utils.expression_is_true:
              expression: "between 30 and 250"
              config:
                where: "hr_max is not null"
                severity: warn
      - name: power_avg
        description: "Average power in watts (may be null)"
        tests:
          - dbt_utils.expression_is_true:
              expression: "between 0 and 2000"
              config:
                where: "power_avg is not null"
                severity: warn
      - name: workout_type
        description: "Type of workout"
        tests:
          - accepted_values:
              values: ['None', 'Race', 'Long Run', 'Workout', 'Unknown']
      - name: athlete_id
        description: "ID of the athlete"
        tests:
          - not_null
          - relationships:
              to: source('strava', 'activities')
              field: athlete__id
              config:
                severity: warn